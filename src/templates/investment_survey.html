{% extends "base.html" %}

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}

{% endwith %}

{% block content %}
<div class="investment-survey-container">
    <div class="investment-survey-card">
        <h1 class="investment-survey-title">Investment Profile</h1>
        <p class="investment-survey-description">Help us understand your investment goals and preferences.</p>
        
        <form method="POST" id="investment-survey-form">
            {{ form.hidden_tag() }}
            
            <!-- 1. Personal Information -->
            <div class="investment-survey-section">
                <h2 class="investment-survey-section-title">1. Personal Information</h2>
                <div class="investment-survey-form-group">
                    {{ form.age.label(class="investment-survey-form-label") }}
                    {{ form.age(class="investment-survey-form-input") }}
                </div>
                <div class="investment-survey-form-group">
                    {{ form.country.label(class="investment-survey-form-label") }}
                    {{ form.country(class="investment-survey-form-select") }}
                </div>
                <div class="investment-survey-form-group">
                    {{ form.education_level.label(class="investment-survey-form-label") }}
                    {{ form.education_level(class="investment-survey-form-select") }}
                </div>
            </div>

            <!-- 2. Financial Information -->
            <div class="investment-survey-section">
                <h2 class="investment-survey-section-title">2. Financial Information</h2>
                <div class="investment-survey-form-group">
                    {{ form.annual_income.label(class="investment-survey-form-label") }}
                    {{ form.annual_income(class="investment-survey-form-input") }}
                </div>
                <div class="investment-survey-form-group">
                    {{ form.monthly_investment.label(class="investment-survey-form-label") }}
                    {{ form.monthly_investment(class="investment-survey-form-input") }}
                </div>
                <div class="investment-survey-form-group">
                    {{ form.net_worth.label(class="investment-survey-form-label") }}
                    {{ form.net_worth(class="investment-survey-form-input") }}
                </div>
            </div>

            <!-- 3. Investment Preferences -->
            <div class="investment-survey-section">
                <h2 class="investment-survey-section-title">3. Investment Preferences</h2>
                
                <!-- Risk Tolerance Slider -->
                <div class="investment-survey-form-group">
                    {{ form.risk_tolerance.label(class="investment-survey-form-label") }}
                    <div class="slider-container">
                        <div class="slider-labels">
                            <span>Low Risk</span>
                            <span>Moderately Low Risk</span>
                            <span>Moderate Risk</span>
                            <span>Moderately High Risk</span>
                            <span>High Risk</span>
                        </div>
                        <input type="range" id="risk_tolerance_slider" min="1" max="5" step="1" value="1">
                        {{ form.risk_tolerance(id="risk_tolerance_hidden", style="display: none;") }}
                    </div>
                </div>

                <!-- Investment Horizon -->
                <div class="investment-survey-form-group">
                    {{ form.investment_horizon.label(class="investment-survey-form-label") }}
                    <div class="box-select">
                        {% for value, label in form.investment_horizon.choices %}
                            <div class="box-select-item">
                                <input type="radio" name="investment_horizon" id="horizon-{{ value }}" value="{{ value }}">
                                <label for="horizon-{{ value }}">{{ label }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Preferred Industries -->
                <div class="investment-survey-form-group">
                    {{ form.preferred_industries.label(class="investment-survey-form-label") }}
                    <div class="box-select multiple">
                        {% for value, label in form.preferred_industries.choices %}
                            <div class="box-select-item">
                                <input type="checkbox" name="preferred_industries" id="industry-{{ value }}" value="{{ value }}">
                                <label for="industry-{{ value }}">{{ label }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Investment Experience Slider -->
                <div class="investment-survey-form-group">
                    {{ form.investment_experience.label(class="investment-survey-form-label") }}
                    <div class="slider-container">
                        <div class="slider-labels">
                            <span>Beginner</span>
                            <span>Intermediate -</span>
                            <span>Intermediate</span>
                            <span>Intermediate +</span>
                            <span>Advanced</span>
                        </div>
                        <input type="range" id="investment_experience_slider" min="1" max="5" step="1" value="1">
                        {{ form.investment_experience(id="investment_experience_hidden", style="display: none;") }}
                    </div>
                </div>

                <!-- Years Investing Slider -->
                <div class="investment-survey-form-group">
                    {{ form.years_investing.label(class="investment-survey-form-label") }}
                    <div class="slider-container">
                        <div class="slider-labels">
                            <span>Less than 1 year</span>
                            <span>1-3 years</span>
                            <span>3-5 years</span>
                            <span>More than 5 years</span>
                        </div>
                        <input type="range" id="years_investing_slider" min="1" max="4" step="1" value="1">
                        {{ form.years_investing(id="years_investing_hidden",style="display: none;") }}
                    </div>
                </div>
            </div>

            <!-- 4. Investment Goals -->
            <div class="investment-survey-section">
                <h2 class="investment-survey-section-title">4. Investment Goals</h2>
                
                <!-- Primary Investment Goal -->
                <div class="investment-survey-form-group">
                    {{ form.primary_investment_goal.label(class="investment-survey-form-label") }}
                    <div class="box-select">
                        {% for value, label in form.primary_investment_goal.choices %}
                            <div class="box-select-item">
                                <input type="radio" name="primary_investment_goal" id="goal-{{ value }}" value="{{ value }}">
                                <label for="goal-{{ value }}">{{ label }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Secondary Investment Goals -->
                <div class="investment-survey-form-group">
                    {{ form.secondary_investment_goals.label(class="investment-survey-form-label") }}
                    <div class="box-select multiple">
                        {% for value, label in form.secondary_investment_goals.choices %}
                            <div class="box-select-item">
                                <input type="checkbox" name="secondary_investment_goals" id="secondary-goal-{{ value }}" value="{{ value }}">
                                <label for="secondary-goal-{{ value }}">{{ label }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Sustainable Investments -->
                <div class="investment-survey-form-group">
                    {{ form.sustainable_investing.label(class="investment-survey-form-label") }}
                    <div class="box-select">
                        {% for value, label in form.sustainable_investing.choices %}
                            <div class="box-select-item">
                                <input type="radio" name="sustainable_investing" id="sustainable-{{ value }}" value="{{ value }}">
                                <label for="sustainable-{{ value }}">{{ label }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- 5. Portfolio Review -->
            <div class="investment-survey-section">
                <h2 class="investment-survey-section-title">5. Portfolio Review</h2>
                
                <div class="investment-survey-form-group">
                    {{ form.has_existing_portfolio.label(class="investment-survey-form-label") }}
                    <div class="box-select">
                        {% for value, label in form.has_existing_portfolio.choices %}
                            <div class="box-select-item">
                                <input type="radio" name="has_existing_portfolio" id="portfolio-{{ value }}" value="{{ value }}">
                                <label for="portfolio-{{ value }}">{{ label }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <!-- Conditional Questions -->
            </div>

            {{ form.submit(class="investment-survey-submit-btn") }}
        </form>
    </div>
</div>

<script>

    function updateHiddenField(slider, hidden) {
        hidden.value = slider.value;
    }
    
    function initializeSlider(slider, hidden) {
        slider.value = hidden.value || slider.value;
        updateHiddenField(slider, hidden);
        slider.addEventListener('input', () => updateHiddenField(slider, hidden));
    }
    
    const riskToleranceSlider = document.getElementById('risk_tolerance_slider');
    const riskToleranceHidden = document.getElementById('risk_tolerance_hidden');
    const experienceSlider = document.getElementById('investment_experience_slider');
    const experienceHidden = document.getElementById('investment_experience_hidden');
    const yearsInvestingSlider = document.getElementById('years_investing_slider');
    const yearsInvestingHidden = document.getElementById('years_investing_hidden');
    
    initializeSlider(riskToleranceSlider, riskToleranceHidden);
    initializeSlider(experienceSlider, experienceHidden);
    initializeSlider(yearsInvestingSlider, yearsInvestingHidden);


    document.getElementById('investment-survey-form').addEventListener('submit', function(e) {
        // Update hidden fields before form submission
        updateHiddenField(riskToleranceSlider, riskToleranceHidden);
        updateHiddenField(experienceSlider, experienceHidden);
        updateHiddenField(yearsInvestingSlider, yearsInvestingHidden);
    });
</script>
{% endblock %}